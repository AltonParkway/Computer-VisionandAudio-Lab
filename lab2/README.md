# 介绍

这是视听觉信号处理的第二个实验——语音差分编码（DPCM）。总体来讲，思路上还是比较简单的，很容易理解。如果编程能力好的话，相信很快就能完成。奈何我太菜了，写了几个晚上才算搞定。做了点扩展，添加了自己神奇的想法，在这里记录一下。

博客地址：[语音差分编码（DPCM）的实现与改进——Python实现](https://blog.csdn.net/rocketeerLi/article/details/84035279)

# DPCM 原理

DPCM 的原理很简单，就是利用信号采样点之间的关联性，即**每个采样点与相邻的采样点之间的差别很小**，因此，就可以利用该特性进行压缩。总地来说，就是**先存储第一个采样点的数值，再存储每个采样点与前一个采样点之间的差值**，作为压缩的数据。这样的话，就可以利用第一个采样点，加上差值，求出第二个采样点，然后再加差值......一直持续下去，就可以求出所有采样点的数值了，也就完成了语音还原。而且，由于没个采样点之间相差很小，因此，差值也不会很大，所以就可以利用较少的比特数来存储压缩的数据了，这样也就实现了压缩。

## 量化误差

由于，这里的差值可能过大，为便于存储，一般设置一个量化因子，比如，如果量化因子是100的话，差值 400 就可以映射到 4 ，这样的话**压缩数据可以用更少的比特存储**，但容易出现**量化误差**。如果将所有的差值固定在一定的范围内（比如这次实验，存储比特为4，差值范围就是 -8 到 7 ，再乘上量化因子）。因此，**如果差值过大或者过小，超出范围了，就只能按照边界值来定**。而这样的话，就会导致量化误差。

> 由于计算出来的差值需要被量化，即映射到 -7 到 8。由于量化过程中，可能会因为差值超出可以正确量化的范围，导致量化值精度不够，从而可能导致解压过程中计算出来的值与被压缩数据不同。这种量化过程中出现的误差就是量化误差。

## 边压缩，边解压

如果一个数据出现了量化误差，那么后面的数据在还原的过程中就会在错误的数据上进行还原，这样的话，会让**之前出现的误差一直积累下去，影响后面所有的数据还原**。那么该怎么解决呢，最简单的方式就是**边压缩，边解压**，利用上一个还原的数据再对当前的数据进行压缩，这样的话，即使产生量化误差，也**只是影响一个采样点，而不会影响后续采样点的还原**。



# 改进策略


整体算法是，先对每个采样点进行取绝对值然后加一的运算，将所有采样点的值都变换到大于等于1的区间，然后对这个变换后的值取 log， 存储取完 log 之后的相邻数据之间的差值。由于这里的压缩文件需要特意存储一下每个采样点的符号（使用 1 比特），然后再进行解密。相当于每个采样点利用了加密文件的 5 个比特。



## 加密过程：

1. 首先，对每个采样点进行变换，变换到取绝对值加一。

2. 计算差值，根据公式：
 ![差值公式](https://img-blog.csdnimg.cn/20181113181754820.png)
将所有差值存到一个数组 d[0:n] 中

4. 计算映射，将计算所得到的差值进行量化，即将差值映射到 -8 到 7 这个区间（压缩成4比特，便于存储）。将量化数据存储起来，压缩到文件中时，需要使用该信息。

5. 然后，存储差值，且为了避免误差进行积累，一边解密，一边加密。

6. 最后，需要计算整体采样点的符号，然后利用 1 比特进行存储，每 16 个符号为一组，组成一个 16 比特的无符号整数。（注：这一步可以跟上面的算法并行完成。）

最后计算得到的加密文件格式如下：

![文件格式](https://img-blog.csdnimg.cn/20181113183218407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JvY2tldGVlckxp,size_16,color_FFFFFF,t_70)

## 解密过程：

1. 读取压缩文件，将符号数和差值数区分开，分别存储到不同的数组中。

2. 然后，对差值部分进行解压，利用公式：
![解压公式](https://img-blog.csdnimg.cn/20181113183354699.png)
解压所得到的是原来采样点的绝对值加一，因此，先进行减一操作，然后根据对应的符号数再的符号位来判断该采样点的符号。

4. 最后，得到一个所有采样点的数组。写入 .pcm 文件中。


# 总结

总的来说，这个实验还是挺自由的。我比较喜欢这个实验老师的风格，随意。而且老师强调，做实验不用太拘束，随便写，就跟玩一样。真的挺喜欢这个观点的，实验的主要目的就是让我们熟悉语音，掌握语音的操作和算法，总是按照那么多条条框框来，重心就很容易偏。

